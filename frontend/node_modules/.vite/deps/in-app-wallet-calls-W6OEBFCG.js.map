{
  "version": 3,
  "sources": ["../../thirdweb/src/wallets/in-app/core/eip5792/in-app-wallet-calls.ts"],
  "sourcesContent": ["import type { Chain } from \"../../../../chains/types.js\";\nimport type { ThirdwebClient } from \"../../../../client/client.js\";\nimport { eth_getTransactionReceipt } from \"../../../../rpc/actions/eth_getTransactionReceipt.js\";\nimport { getRpcClient } from \"../../../../rpc/rpc.js\";\nimport { sendAndConfirmTransaction } from \"../../../../transaction/actions/send-and-confirm-transaction.js\";\nimport { sendBatchTransaction } from \"../../../../transaction/actions/send-batch-transaction.js\";\nimport type { SendTransactionOptions } from \"../../../../transaction/actions/send-transaction.js\";\nimport { LruMap } from \"../../../../utils/caching/lru.js\";\nimport type { Hex } from \"../../../../utils/encoding/hex.js\";\nimport { randomBytesHex } from \"../../../../utils/random.js\";\nimport type { PreparedSendCall } from \"../../../eip5792/send-calls.js\";\nimport type {\n  GetCallsStatusResponse,\n  WalletCallReceipt,\n} from \"../../../eip5792/types.js\";\nimport type { Account } from \"../../../interfaces/wallet.js\";\n\nconst bundlesToTransactions = new LruMap<Hex[]>(1000);\n\n/**\n * @internal\n */\nexport async function inAppWalletSendCalls(args: {\n  account: Account;\n  calls: PreparedSendCall[];\n  chain: Chain;\n}): Promise<string> {\n  const { account, calls } = args;\n\n  const transactions: SendTransactionOptions[\"transaction\"][] = calls.map(\n    (call) => ({\n      ...call,\n      chain: args.chain,\n    }),\n  );\n\n  const hashes: Hex[] = [];\n  const id = randomBytesHex(65);\n  bundlesToTransactions.set(id, hashes);\n  if (account.sendBatchTransaction) {\n    const receipt = await sendBatchTransaction({\n      account,\n      transactions,\n    });\n    hashes.push(receipt.transactionHash);\n    bundlesToTransactions.set(id, hashes);\n  } else {\n    for (const tx of transactions) {\n      const receipt = await sendAndConfirmTransaction({\n        account,\n        transaction: tx,\n      });\n      hashes.push(receipt.transactionHash);\n      bundlesToTransactions.set(id, hashes);\n    }\n  }\n\n  return id;\n}\n\n/**\n * @internal\n */\nexport async function inAppWalletGetCallsStatus(args: {\n  chain: Chain;\n  client: ThirdwebClient;\n  id: string;\n}): Promise<GetCallsStatusResponse> {\n  const { chain, client, id } = args;\n\n  const bundle = bundlesToTransactions.get(id);\n  if (!bundle) {\n    throw new Error(\"Failed to get calls status, unknown bundle id\");\n  }\n\n  const request = getRpcClient({ chain, client });\n  let status: \"pending\" | \"success\" | \"failure\" = \"success\";\n  const receipts: (WalletCallReceipt<bigint, \"success\" | \"reverted\"> | null)[] =\n    await Promise.all(\n      bundle.map((hash) =>\n        eth_getTransactionReceipt(request, { hash })\n          .then((receipt) => ({\n            blockHash: receipt.blockHash,\n            blockNumber: receipt.blockNumber,\n            gasUsed: receipt.gasUsed,\n            logs: receipt.logs.map((l) => ({\n              address: l.address,\n              data: l.data,\n              topics: l.topics,\n            })),\n            status: receipt.status,\n            transactionHash: receipt.transactionHash,\n          }))\n          .catch(() => {\n            status = \"pending\";\n            return null; // Return null if there's an error to filter out later\n          }),\n      ),\n    );\n\n  return {\n    atomic: false,\n    chainId: chain.id,\n    id,\n    receipts: receipts.filter((r) => r !== null),\n    status,\n    statusCode: 200,\n    version: \"2.0.0\",\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBA,IAAM,wBAAwB,IAAI,OAAc,GAAI;AAKpD,eAAsB,qBAAqB,MAI1C;AACC,QAAM,EAAE,SAAS,MAAK,IAAK;AAE3B,QAAM,eAAwD,MAAM,IAClE,CAAC,UAAU;IACT,GAAG;IACH,OAAO,KAAK;IACZ;AAGJ,QAAM,SAAgB,CAAA;AACtB,QAAM,KAAK,eAAe,EAAE;AAC5B,wBAAsB,IAAI,IAAI,MAAM;AACpC,MAAI,QAAQ,sBAAsB;AAChC,UAAM,UAAU,MAAM,qBAAqB;MACzC;MACA;KACD;AACD,WAAO,KAAK,QAAQ,eAAe;AACnC,0BAAsB,IAAI,IAAI,MAAM;EACtC,OAAO;AACL,eAAW,MAAM,cAAc;AAC7B,YAAM,UAAU,MAAM,0BAA0B;QAC9C;QACA,aAAa;OACd;AACD,aAAO,KAAK,QAAQ,eAAe;AACnC,4BAAsB,IAAI,IAAI,MAAM;IACtC;EACF;AAEA,SAAO;AACT;AAKA,eAAsB,0BAA0B,MAI/C;AACC,QAAM,EAAE,OAAO,QAAQ,GAAE,IAAK;AAE9B,QAAM,SAAS,sBAAsB,IAAI,EAAE;AAC3C,MAAI,CAAC,QAAQ;AACX,UAAM,IAAI,MAAM,+CAA+C;EACjE;AAEA,QAAM,UAAU,aAAa,EAAE,OAAO,OAAM,CAAE;AAC9C,MAAI,SAA4C;AAChD,QAAM,WACJ,MAAM,QAAQ,IACZ,OAAO,IAAI,CAAC,SACV,0BAA0B,SAAS,EAAE,KAAI,CAAE,EACxC,KAAK,CAAC,aAAa;IAClB,WAAW,QAAQ;IACnB,aAAa,QAAQ;IACrB,SAAS,QAAQ;IACjB,MAAM,QAAQ,KAAK,IAAI,CAAC,OAAO;MAC7B,SAAS,EAAE;MACX,MAAM,EAAE;MACR,QAAQ,EAAE;MACV;IACF,QAAQ,QAAQ;IAChB,iBAAiB,QAAQ;IACzB,EACD,MAAM,MAAK;AACV,aAAS;AACT,WAAO;EACT,CAAC,CAAC,CACL;AAGL,SAAO;IACL,QAAQ;IACR,SAAS,MAAM;IACf;IACA,UAAU,SAAS,OAAO,CAAC,MAAM,MAAM,IAAI;IAC3C;IACA,YAAY;IACZ,SAAS;;AAEb;",
  "names": []
}
