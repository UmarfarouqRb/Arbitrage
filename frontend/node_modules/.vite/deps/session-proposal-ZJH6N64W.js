import {
  disconnectWalletConnectSession,
  getSessions,
  saveSession
} from "./chunk-X2GTXS2A.js";
import "./chunk-54ADBJ54.js";
import "./chunk-OICIL5QT.js";
import "./chunk-W6IOXIRF.js";
import "./chunk-LHTHZIPF.js";
import "./chunk-A4BR4K66.js";
import "./chunk-MSJJOEBS.js";
import "./chunk-67YIWUOQ.js";
import "./chunk-FUW7UPWG.js";
import "./chunk-5GPJCQB3.js";
import "./chunk-AL7AZVTW.js";
import "./chunk-IBXM4QFM.js";
import "./chunk-FHM7BLOT.js";
import "./chunk-ZTSTPI2U.js";
import "./chunk-IW3I3RWX.js";
import "./chunk-QCGN5F3I.js";
import "./chunk-237EVM5Y.js";
import "./chunk-J6NIOEGA.js";
import "./chunk-BREECRX7.js";
import "./chunk-PN6DQXIK.js";
import "./chunk-PANVS3XX.js";
import "./chunk-L4NN5UUQ.js";
import "./chunk-5AWZZDTC.js";
import "./chunk-EBPJZRGO.js";
import "./chunk-S4ZD6P6T.js";
import "./chunk-YGHTSOJ2.js";
import "./chunk-OM2KKZMP.js";
import "./chunk-LPC2L23M.js";
import "./chunk-QMDVOU32.js";
import "./chunk-QFKZXB2I.js";
import "./chunk-X7CG3L2Z.js";
import "./chunk-DVNKWNZO.js";
import "./chunk-2CIJO3V3.js";
import "./chunk-UZAMIWMY.js";
import "./chunk-6SVI5C4W.js";
import "./chunk-ESTOX3EM.js";
import "./chunk-CCP6WQOA.js";
import "./chunk-HR2UIEMV.js";
import "./chunk-Z2MF3EIF.js";
import "./chunk-G24WGTAU.js";
import "./chunk-TU6UWWTV.js";
import "./chunk-3OXDSLPJ.js";
import "./chunk-TVKFAMBW.js";
import "./chunk-PPP72TBL.js";
import "./chunk-OS7ZSSJM.js";

// node_modules/thirdweb/dist/esm/wallets/wallet-connect/receiver/session-proposal.js
async function onSessionProposal(options) {
  var _a, _b;
  const { wallet, walletConnectClient, event, chains, onConnect } = options;
  const account = wallet.getAccount();
  if (!account) {
    throw new Error("No account connected to provided wallet");
  }
  const origin = (_b = (_a = event.verifyContext) == null ? void 0 : _a.verified) == null ? void 0 : _b.origin;
  if (origin) {
    await disconnectExistingSessions({ origin, walletConnectClient });
  }
  const session = await acceptSessionProposal({
    account,
    chains,
    sessionProposal: event,
    walletConnectClient
  });
  await saveSession(session);
  wallet.subscribe("disconnect", () => {
    disconnectWalletConnectSession({ session, walletConnectClient });
  });
  onConnect == null ? void 0 : onConnect(session);
}
async function disconnectExistingSessions({ walletConnectClient, origin }) {
  const sessions = await getSessions();
  for (const session of sessions) {
    if (session.origin === origin) {
      await disconnectWalletConnectSession({ session, walletConnectClient });
    }
  }
}
async function acceptSessionProposal({ account, walletConnectClient, sessionProposal, chains }) {
  var _a, _b, _c, _d, _e, _f, _g, _h, _i, _j, _k, _l, _m, _n, _o, _p, _q, _r;
  if (!((_a = sessionProposal.params.requiredNamespaces) == null ? void 0 : _a.eip155) && !((_b = sessionProposal.params.optionalNamespaces) == null ? void 0 : _b.eip155)) {
    throw new Error("No EIP155 namespace found in Wallet Connect session proposal");
  }
  const namespaces = {
    chains: [
      ...Array.from(/* @__PURE__ */ new Set([
        ...((_e = (_d = (_c = sessionProposal.params.requiredNamespaces) == null ? void 0 : _c.eip155) == null ? void 0 : _d.chains) == null ? void 0 : _e.map((chain) => `${chain}:${account.address}`)) ?? [],
        ...((_h = (_g = (_f = sessionProposal.params.optionalNamespaces) == null ? void 0 : _f.eip155) == null ? void 0 : _g.chains) == null ? void 0 : _h.map((chain) => `${chain}:${account.address}`)) ?? [],
        ...(chains == null ? void 0 : chains.map((chain) => `eip155:${chain.id}:${account.address}`)) ?? []
      ]))
    ],
    events: [
      ...((_j = (_i = sessionProposal.params.requiredNamespaces) == null ? void 0 : _i.eip155) == null ? void 0 : _j.events) ?? [],
      ...((_l = (_k = sessionProposal.params.optionalNamespaces) == null ? void 0 : _k.eip155) == null ? void 0 : _l.events) ?? []
    ],
    methods: [
      ...((_n = (_m = sessionProposal.params.requiredNamespaces) == null ? void 0 : _m.eip155) == null ? void 0 : _n.methods) ?? [],
      ...((_p = (_o = sessionProposal.params.optionalNamespaces) == null ? void 0 : _o.eip155) == null ? void 0 : _p.methods) ?? []
    ]
  };
  const approval = await walletConnectClient.approve({
    id: sessionProposal.id,
    namespaces: {
      eip155: {
        accounts: namespaces.chains,
        events: namespaces.events,
        methods: namespaces.methods
      }
    }
  });
  const session = await approval.acknowledged();
  return {
    origin: ((_r = (_q = sessionProposal.verifyContext) == null ? void 0 : _q.verified) == null ? void 0 : _r.origin) || "Unknown origin",
    topic: session.topic
  };
}
export {
  acceptSessionProposal,
  disconnectExistingSessions,
  onSessionProposal
};
//# sourceMappingURL=session-proposal-ZJH6N64W.js.map
