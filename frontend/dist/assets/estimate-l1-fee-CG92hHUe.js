import{bd as G,be as x,bf as p,bg as a,bh as B,bi as H,bj as L,bk as m,bl as v,bm as T,o as I,bn as N,bo as k,bp as h,bq as K,O as D,aQ as V,r as q}from"./index-B3E2rKjL.js";function $(r){if(!r||r.length===0)return[];const e=[];for(const{address:t,storageKeys:i}of r){for(let n=0;n<i.length;n++)if(G(i[n])!==32)throw new M({storageKey:i[n]});t&&x(t,{strict:!1}),e.push([t,i])}return e}class M extends p{constructor({storageKey:e}){super(`Size for storage key "${e}" is invalid. Expected 32 bytes. Got ${G(e)} bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AccessList.InvalidStorageKeySizeError"})}}const E={wei:0,gwei:9,szabo:12,finney:15,ether:18};function Q(r,e=0){let t=r.toString();const i=t.startsWith("-");i&&(t=t.slice(1)),t=t.padStart(e,"0");let[n,o]=[t.slice(0,t.length-e),t.slice(t.length-e)];return o=o.replace(/(0+)$/,""),`${i?"-":""}${n||"0"}${o?`.${o}`:""}`}function w(r,e="wei"){return Q(r,E.gwei-E[e])}class W extends p{constructor({feeCap:e}={}){super(`The fee cap (\`maxFeePerGas\`/\`maxPriorityFeePerGas\`${e?` = ${w(e)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TransactionEnvelope.FeeCapTooHighError"})}}class C extends p{constructor({gasPrice:e}={}){super(`The gas price (\`gasPrice\`${e?` = ${w(e)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TransactionEnvelope.GasPriceTooHighError"})}}class P extends p{constructor({chainId:e}){super(typeof e<"u"?`Chain ID "${e}" is invalid.`:"Chain ID is invalid."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TransactionEnvelope.InvalidChainIdError"})}}class Y extends p{constructor({maxPriorityFeePerGas:e,maxFeePerGas:t}={}){super([`The provided tip (\`maxPriorityFeePerGas\`${e?` = ${w(e)} gwei`:""}) cannot be higher than the fee cap (\`maxFeePerGas\`${t?` = ${w(t)} gwei`:""}).`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TransactionEnvelope.TipAboveFeeCapError"})}}function O(r){const{chainId:e,gasPrice:t,to:i}=r;if(i&&x(i,{strict:!1}),typeof e<"u"&&e<=0)throw new P({chainId:e});if(t&&BigInt(t)>2n**256n-1n)throw new C({gasPrice:t})}function _(r,e={}){const{chainId:t=0,gas:i,data:n,input:o,nonce:c,to:d,value:f,gasPrice:l}=r;O(r);let u=[c?a(c):"0x",l?a(l):"0x",i?a(i):"0x",d??"0x",f?a(f):"0x",n??o??"0x"];const s=(()=>{if(e.signature)return{r:e.signature.r,s:e.signature.s,v:B(e.signature.yParity)};if(!(typeof r.r>"u"||typeof r.s>"u"))return{r:r.r,s:r.s,v:r.v}})();if(s){const y=(()=>{if(s.v>=35)return Math.floor((s.v-35)/2)>0?s.v:27+(s.v===35?0:1);if(t>0)return t*2+35+s.v-27;const g=27+(s.v===27?0:1);if(s.v!==g)throw new H({value:s.v});return g})();u=[...u,a(y),s.r===0n?"0x":L(a(s.r)),s.s===0n?"0x":L(a(s.s))]}else t>0&&(u=[...u,a(t),"0x","0x"]);return m(u)}const J="0x02";function z(r){const{chainId:e,maxPriorityFeePerGas:t,maxFeePerGas:i,to:n}=r;if(e<=0)throw new P({chainId:e});if(n&&x(n,{strict:!1}),i&&BigInt(i)>2n**256n-1n)throw new W({feeCap:i});if(t&&i&&t>i)throw new Y({maxFeePerGas:i,maxPriorityFeePerGas:t})}function R(r,e={}){const{chainId:t,gas:i,nonce:n,to:o,value:c,maxFeePerGas:d,maxPriorityFeePerGas:f,accessList:l,data:u,input:s}=r;z(r);const y=$(l),g=v(e.signature||r),b=[a(t),n?a(n):"0x",f?a(f):"0x",d?a(d):"0x",i?a(i):"0x",o??"0x",c?a(c):"0x",u??s??"0x",y,...g?T(g):[]];return I(J,m(b))}function S(r){const{chainId:e,gasPrice:t,to:i}=r;if(e<=0)throw new P({chainId:e});if(i&&x(i,{strict:!1}),t&&BigInt(t)>2n**256n-1n)throw new C({gasPrice:t})}function U(r,e={}){const{chainId:t,gas:i,data:n,input:o,nonce:c,to:d,value:f,accessList:l,gasPrice:u}=r;S(r);const s=$(l),y=v(e.signature||r),g=[a(t),c?a(c):"0x",u?a(u):"0x",i?a(i):"0x",d??"0x",f?a(f):"0x",n??o??"0x",s,...y?T(y):[]];return I("0x01",m(g))}const X="0x04";function j(r){const{authorizationList:e}=r;if(e)for(const t of e){const{address:i,chainId:n}=t;if(i&&x(i,{strict:!1}),Number(n)<0)throw new P({chainId:n})}z(r)}function Z(r,e={}){const{authorizationList:t,chainId:i,gas:n,nonce:o,to:c,value:d,maxFeePerGas:f,maxPriorityFeePerGas:l,accessList:u,data:s,input:y}=r;j(r);const g=$(u),b=N(t),F=v(e.signature||r),A=[a(i),o?a(o):"0x",l?a(l):"0x",f?a(f):"0x",n?a(n):"0x",c??"0x",d?a(d):"0x",s??y??"0x",g,b,...F?T(F):[]];return I(X,m(A))}function ee(r){const{transaction:e}=r,t=re(e),i=(()=>{if(r.signature)return"v"in r.signature&&typeof r.signature.v<"u"?k({r:h(r.signature.r),s:h(r.signature.s),v:Number(r.signature.v)}):{r:h(r.signature.r),s:h(r.signature.s),yParity:r.signature.yParity};if(!(typeof e.v>"u"&&typeof e.yParity>"u")){if(e.r===void 0||e.s===void 0)throw new Error("Invalid signature provided with transaction");return{r:typeof e.r=="bigint"?e.r:h(e.r),s:typeof e.s=="bigint"?e.s:h(e.s),yParity:typeof e.v<"u"&&typeof e.yParity>"u"?K(Number(e.v)):Number(e.yParity)}}})();if(t==="eip1559"){const n=e;return z(n),R(n,{signature:i})}if(t==="legacy"){const n=e;return O(n),_(n,{signature:i})}if(t==="eip2930"){const n=e;return S(n),U(n,{signature:i})}if(t==="eip7702"){const n=e;return j(n),Z(n,{signature:i})}throw new Error("Invalid transaction type")}function re(r){if(typeof r.type<"u")return r.type;if(typeof r.authorizationList<"u")return"eip7702";if(typeof r.maxFeePerGas<"u"||typeof r.maxPriorityFeePerGas<"u")return"eip1559";if(typeof r.gasPrice<"u")return typeof r.accessList<"u"?"eip2930":"legacy";throw new Error("Invalid transaction type")}const te="0x420000000000000000000000000000000000000F";async function ne(r){const{transaction:e,gasPriceOracleAddress:t}=r,i=D({address:t||te,chain:e.chain,client:e.client}),{gasPrice:n,...o}=await V({transaction:e}),c=ee({transaction:o});return q({contract:i,method:"function getL1Fee(bytes memory _data) view returns (uint256)",params:[c]})}export{ne as estimateL1Fee};
